__author__ = 'christiaan'


UserName = "christiaanleysen"
APIKey = "8ZcY4fECnsvAZqSoBSxo"
import plotly
#plotly.tools.set_credentials_file(username=UserName, api_key=APIKey)

import plotly.dashboard_objs as dashboard
import dataLoader as DL
from bs4 import BeautifulSoup as Soup





my_dboard = dashboard.Dashboard()
my_dboard.get_preview()
import plotly.offline as py

def makePlot(df):
      #print('colums',df.columns)
      return py.plot([{
        'x': df.index,
        'y': df[col],
        'name': col
    }  for col in df.columns],auto_open=False,filename='christiaanl',include_plotlyjs=False, output_type='div')


def fileId_from_url(url):
    """Return fileId from a url."""
    index = url.find('~')
    fileId = url[index + 1:]
    local_id_index = fileId.find('/')

    share_key_index = fileId.find('?share_key')
    if share_key_index == -1:
        return fileId.replace('/', ':')
    else:
        return fileId[:share_key_index].replace('/', ':')




def addPlotToDashboard(divtexts):
    HtmlFile = open('templates/template.html', 'r')
    soup = Soup(HtmlFile, 'html.parser')

    for div in divtexts:
        print(div)
        print('SOUP',Soup(div, 'html.parser').get_text())
        soup.div.append(Soup(div, 'html.parser'))
    HtmlFile.close()

    html = soup.prettify("utf-8")

    with open("output.html", "wb") as file:
        file.write(html)

def removeAllPlots():
    HtmlFile = open('templates/template.html', 'r')
    soup = Soup(HtmlFile,"html.parser")
    a_tag = soup

    soup.find('div',class_="plotly-graph-div").decompose()
    html = soup.prettify("utf-8")
    with open("output.html", "wb") as file:
        file.write(html)



def addProjectToDashBoard(listOfdf):
    divtexts =[]
    for i in listOfdf:
        #print('TEST',i[1])
        divtext = makePlot(i[1])
        #print(divtext)
        divtexts.append(divtext)

    addPlotToDashboard(divtexts)
    #run.removePlots(divtext)







newPath = '/Users/christiaan/Desktop/Solcor/dataMergeWeek/Nueces del Choapa'
newPath2 = '/Users/christiaan/Desktop/Solcor/dataMergeWeek/gabriel Varela'
newPath3 = '/Users/christiaan/Desktop/Solcor/dataMergeWeek/Puratos'


dataList = DL.fetchFilesforProject(newPath)
dataList2 = DL.fetchFilesforProject(newPath2)
dataList3 = DL.fetchFilesforProject(newPath3)



#addInitialProjectToDashBoard(dataList[0][1],1)
addProjectToDashBoard([dataList,dataList2,dataList3])

